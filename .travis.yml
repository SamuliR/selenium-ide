sudo: required
language: node_js
cache:
  yarn: true
  pip: true
  directories:
    - .peru
node_js:
  - "10"
  - "8"
env:
  - EXTENSION_ID=ncpaajkkckeifkjmdcljncclojbniiig
services:
  - docker
before_install:
  - pyenv install -s 3.6
  - pyenv shell 3.6
  - pip3 install peru
  - peru sync
install:
  - yarn --ignore-engines
  - yarn build:webdriver
  - yarn build:selianize
  - yarn build:runner
  - NODE_ENV="staging" yarn build:ext
  - docker-compose up -d
script:
  - yarn lint
  - yarn test
  - yarn test:webdriver
  - yarn test:runner --server http://localhost:4444/wd/hub --force
deploy:
  provider:
    - yarn bump:ext:version
    - yarn build:ext:prod
    - yarn zip:ext
    - CLIENT_ID=${clieintID} CLIENT_SECRET=${clientSecret} REFRESH_TOKEN=${refreshToken} yarn update:ext:store
